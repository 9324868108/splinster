<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Sign Up - Splinster | Guaranteed Project Delivery</title>
  <meta name="description" content="Create your Splinster account and get guaranteed freelance project delivery. 0% commission for freelancers, 100% money-back guarantee for clients." />
  <meta name="theme-color" content="#4B1ED6" />
  <meta name="robots" content="noindex, nofollow" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet" />

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <style>
    :root{
      --spl-purple:#4B1ED6;
      --spl-purple-ink:#2B0D8A;
    }

    body{
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      background: #fff;
    }

    .font-display{ font-family: Outfit, Inter, ui-sans-serif, system-ui; }

    :focus-visible{ outline: 3px solid rgba(75,30,214,.35); outline-offset: 3px; border-radius: 10px; }

    /* Subtle page load */
    .fade-in{ opacity: 0; transform: translateY(10px); animation: fadeInUp 650ms ease forwards; }
    @keyframes fadeInUp{ to{ opacity: 1; transform: translateY(0);} }

    /* Subtle invalid shake */
    .shake{ animation: shake 240ms ease-in-out 0s 2; }
    @keyframes shake{
      0%{ transform: translateX(0); }
      30%{ transform: translateX(-6px); }
      60%{ transform: translateX(6px); }
      100%{ transform: translateX(0); }
    }

    @media (prefers-reduced-motion: reduce){
      .fade-in{ opacity: 1; transform: none; animation: none; }
      .shake{ animation: none; }
      html{ scroll-behavior: auto; }
    }
  </style>
</head>

<body class="text-slate-900">
  <!-- Skip link -->
  <a href="#main" class="sr-only focus:not-sr-only focus:fixed focus:left-4 focus:top-4 focus:z-[999] focus:bg-white focus:text-slate-900 focus:px-4 focus:py-2 focus:shadow-lg">
    Skip to content
  </a>

  <main id="main" class="min-h-screen">
    <!-- Background (subtle, premium) -->
    <div class="min-h-screen w-full" style="background: radial-gradient(900px 600px at 20% 10%, rgba(75,30,214,.16) 0%, rgba(75,30,214,.06) 40%, rgba(255,255,255,0) 72%), linear-gradient(180deg, #ffffff 0%, rgba(75,30,214,.05) 100%);">
      <div class="mx-auto max-w-6xl px-6 min-h-screen flex items-center py-10">

        <!-- Auth shell -->
        <section class="w-full grid gap-8 lg:gap-10 lg:grid-cols-2 items-stretch fade-in" style="animation-delay: 60ms;">

          <!-- LEFT: Brand / reassurance -->
          <aside class="hidden lg:flex rounded-3xl border border-slate-200 bg-white/70 backdrop-blur p-9 flex-col justify-between">
            <div>
              <a href="index.html" class="inline-flex items-center" aria-label="Go to Splinster home">
                <img
                  src="https://image2url.com/r2/bucket1/images/1766620407393-9652041c-1f7f-4a91-b2e5-0b406cd75c2e.png"
                  alt="Splinster"
                  class="h-14 sm:h-16 w-auto drop-shadow-sm"
                  loading="eager"
                  decoding="async"
                />
              </a>

              <h1 class="mt-8 font-display text-4xl font-extrabold tracking-tight">
                Your Projects,<br />
                <span class="text-[color:var(--spl-purple)]">Delivered. Guaranteed.</span>
              </h1>

              <p class="mt-4 text-slate-600 max-w-md">
                Join a guaranteed delivery platform. We monitor progress, intervene early, and protect outcomes — so you’re not carrying the risk.
              </p>

              <div class="mt-8 grid gap-6">
                <div class="flex gap-4">
                  <div class="h-10 w-10 rounded-2xl bg-[#4B1ED6] text-white flex items-center justify-center" aria-hidden="true">✓</div>
                  <div>
                    <div class="font-semibold">100% Money-Back Guarantee</div>
                    <div class="mt-1 text-slate-600">If we don’t deliver, you get fully refunded. Zero risk.</div>
                  </div>
                </div>

                <div class="flex gap-4">
                  <div class="h-10 w-10 rounded-2xl bg-[#4B1ED6] text-white flex items-center justify-center" aria-hidden="true">✓</div>
                  <div>
                    <div class="font-semibold">0% Freelancer Commission</div>
                    <div class="mt-1 text-slate-600">Freelancers keep 100% of earnings — clients pay for the guarantee.</div>
                  </div>
                </div>

                <div class="flex gap-4">
                  <div class="h-10 w-10 rounded-2xl bg-[#4B1ED6] text-white flex items-center justify-center" aria-hidden="true">✓</div>
                  <div>
                    <div class="font-semibold">95% On-Time Delivery</div>
                    <div class="mt-1 text-slate-600">Reliable timelines with proactive monitoring.</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Minimal dashboard mock (compact) -->
            <div class="mt-8 rounded-2xl border border-slate-200 bg-white p-6">
              <div class="flex items-center justify-between">
                <div class="text-sm font-semibold">Assurance Snapshot</div>
                <div class="text-xs text-slate-500">Live monitoring</div>
              </div>
              <div class="mt-5 grid grid-cols-3 gap-3">
                <div class="rounded-2xl border border-slate-200 p-4">
                  <div class="text-xs text-slate-500">Milestones</div>
                  <div class="mt-1 font-semibold">3/5</div>
                  <div class="mt-3 h-2 rounded-full bg-slate-100 overflow-hidden"><div class="h-full w-[60%] bg-[#4B1ED6] rounded-full"></div></div>
                </div>
                <div class="rounded-2xl border border-slate-200 p-4">
                  <div class="text-xs text-slate-500">Quality checks</div>
                  <div class="mt-1 font-semibold">8/8</div>
                  <div class="mt-3 text-xs text-slate-600">✓ Verified</div>
                </div>
                <div class="rounded-2xl border border-slate-200 p-4">
                  <div class="text-xs text-slate-500">Coverage</div>
                  <div class="mt-1 font-semibold">100%</div>
                  <div class="mt-3 text-xs text-slate-600">Refund protected</div>
                </div>
              </div>
            </div>
          </aside>

          <!-- RIGHT: Form card -->
          <section id="authCard" class="rounded-3xl border border-slate-200 bg-white shadow-sm p-7 sm:p-8 lg:p-9 flex flex-col justify-center">
            <!-- Top row: Back + logo (compact) -->
            <div class="flex items-center justify-between gap-4">
              <a href="index.html" class="text-sm text-slate-600 hover:text-slate-900 transition" aria-label="Back to home">← Back to Home</a>
              <a href="index.html" class="inline-flex items-center" aria-label="Splinster home">
                <img
                  src="https://image2url.com/r2/bucket1/images/1766620407393-9652041c-1f7f-4a91-b2e5-0b406cd75c2e.png"
                  alt="Splinster"
                  class="h-14 sm:h-16 w-auto drop-shadow-sm"
                  loading="eager"
                  decoding="async"
                />
              </a>
            </div>

            <h2 class="mt-6 font-display text-3xl sm:text-4xl font-extrabold tracking-tight">Create your account</h2>
            <p class="mt-2 text-slate-600">Join Splinster and get guaranteed project delivery.</p>

            <div class="h-4"></div>

            <!-- Global message -->
            <div id="globalMsg" class="mt-5 hidden" role="status" aria-live="polite"></div>

            <!-- OAuth (icon row) -->
            <div class="mt-6">
              <div class="flex items-center justify-between">
                <div class="text-sm font-semibold text-slate-900">Continue with</div>
                <div class="text-xs text-slate-500">OAuth</div>
              </div>

              <div class="mt-4 flex flex-wrap items-center gap-3 sm:gap-4">
                <button data-oauth="google" type="button" class="oauth-btn h-12 w-12 rounded-full border border-slate-200 bg-white hover:bg-slate-50 hover:shadow-sm hover:scale-[1.03] transition flex items-center justify-center" aria-label="Continue with Google" title="Continue with Google">
                  <img alt="Google" class="h-5 w-5" src="https://www.google.com/images/branding/googleg/1x/googleg_standard_color_128dp.png" />
                </button>

                <button data-oauth="apple" type="button" class="oauth-btn h-12 w-12 rounded-full border border-slate-200 bg-white hover:bg-slate-50 hover:shadow-sm hover:scale-[1.03] transition flex items-center justify-center" aria-label="Continue with Apple" title="Continue with Apple">
                  <svg class="h-5 w-5 text-slate-900" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M16.7 13.6c0 2.8 2.5 3.8 2.5 3.8s-1.9 5.4-4.4 5.4c-1.2 0-2.2-.8-3.5-.8-1.4 0-2.7.8-3.6.8-2.2 0-4.8-4.9-4.8-8.9 0-3.9 2.4-5.9 4.7-5.9 1.2 0 2.2.8 3.4.8 1.1 0 2.8-.9 3.9-.9.4 0 3 .1 4.4 2.4-.1.1-2.6 1.5-2.6 4.3Zm-2.1-8.3c.7-.9 1.2-2.1 1.1-3.3-1.1.1-2.4.7-3.2 1.7-.7.8-1.3 2-1.1 3.2 1.2.1 2.4-.6 3.2-1.6Z"/>
                  </svg>
                </button>

                <button data-oauth="linkedin" type="button" class="oauth-btn h-12 w-12 rounded-full border border-slate-200 bg-white hover:bg-slate-50 hover:shadow-sm hover:scale-[1.03] transition flex items-center justify-center" aria-label="Continue with LinkedIn" title="Continue with LinkedIn">
                  <img alt="LinkedIn" class="h-5 w-5" src="https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png" />
                </button>

                <button data-oauth="github" type="button" class="oauth-btn h-12 w-12 rounded-full border border-slate-200 bg-white hover:bg-slate-50 hover:shadow-sm hover:scale-[1.03] transition flex items-center justify-center" aria-label="Continue with GitHub" title="Continue with GitHub">
                  <img alt="GitHub" class="h-5 w-5" src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" />
                </button>
              </div>
            </div>

            <!-- Divider -->
            <div class="my-5 flex items-center gap-4" aria-hidden="true">
              <div class="h-px flex-1 bg-slate-200"></div>
              <div class="text-xs font-semibold tracking-[0.22em] text-slate-500">OR</div>
              <div class="h-px flex-1 bg-slate-200"></div>
            </div>

            <!-- Form -->
            <form id="signupForm" class="grid gap-4" novalidate>
              <input type="hidden" id="csrf" name="csrf" value="" />

              <div class="grid gap-5 sm:grid-cols-2">
                <div>
                  <label for="fullName" class="text-sm font-semibold text-slate-900">Full Name</label>
                  <input id="fullName" name="fullName" type="text" autocomplete="name" placeholder="Full name" class="mt-2 h-12 w-full rounded-xl border border-slate-200 bg-white px-4 text-[15px] outline-none focus:border-[#4B1ED6] transition" aria-required="true" />
                  <p id="fullNameErr" class="mt-2 text-sm text-red-600 hidden" role="alert"></p>
                </div>

                <div>
                  <label for="email" class="text-sm font-semibold text-slate-900">Email Address</label>
                  <input id="email" name="email" type="email" autocomplete="email" inputmode="email" placeholder="you@example.com" class="mt-2 h-12 w-full rounded-xl border border-slate-200 bg-white px-4 text-[15px] outline-none focus:border-[#4B1ED6] transition" aria-required="true" />
                  <p id="emailErr" class="mt-2 text-sm text-red-600 hidden" role="alert"></p>
                </div>
              </div>

              <div>
                <div class="flex items-center justify-between">
                  <label for="password" class="text-sm font-semibold text-slate-900">Password</label>
                  <button id="togglePwd" type="button" class="text-sm font-semibold text-[color:var(--spl-purple)] hover:underline" aria-label="Show password">Show</button>
                </div>

                <input id="password" name="password" type="password" autocomplete="new-password" placeholder="Create a strong password" class="mt-2 h-12 w-full rounded-xl border border-slate-200 bg-white px-4 text-[15px] outline-none focus:border-[#4B1ED6] transition" aria-required="true" />

                <div class="mt-2 flex items-center justify-between gap-4">
                  <p class="text-xs text-slate-600">Min 8 chars • upper/lower • number • special</p>
                  <div class="inline-flex items-center gap-2">
                    <div class="h-2 w-24 rounded-full bg-slate-100 overflow-hidden" aria-hidden="true">
                      <div id="strengthBar" class="h-full w-0 bg-red-500 transition-all"></div>
                    </div>
                    <div id="strengthLabel" class="text-xs font-semibold text-slate-600">Weak</div>
                  </div>
                </div>

                <div class="mt-3 grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-slate-600" aria-live="polite">
                  <div class="flex items-center gap-2"><span id="reqLen" class="text-slate-400">•</span><span>8+ chars</span></div>
                  <div class="flex items-center gap-2"><span id="reqUpper" class="text-slate-400">•</span><span>Uppercase</span></div>
                  <div class="flex items-center gap-2"><span id="reqLower" class="text-slate-400">•</span><span>Lowercase</span></div>
                  <div class="flex items-center gap-2"><span id="reqNumber" class="text-slate-400">•</span><span>Number</span></div>
                  <div class="flex items-center gap-2 col-span-2"><span id="reqSpecial" class="text-slate-400">•</span><span>Special character</span></div>
                </div>

                <p id="passwordErr" class="mt-2 text-sm text-red-600 hidden" role="alert"></p>
              </div>

              <fieldset class="mt-1">
                <legend class="text-sm font-semibold text-slate-900">I am signing up as…</legend>
                <div class="mt-3 grid gap-3 sm:grid-cols-2">
                  <label class="flex items-start gap-3 rounded-2xl border border-slate-200 p-4 hover:border-slate-300 transition cursor-pointer">
                    <input class="mt-1" type="radio" name="role" value="client" />
                    <span>
                      <span class="font-semibold text-slate-900">Client</span>
                      <span class="block text-sm text-slate-600">Guaranteed project delivery</span>
                    </span>
                  </label>
                  <label class="flex items-start gap-3 rounded-2xl border border-slate-200 p-4 hover:border-slate-300 transition cursor-pointer">
                    <input class="mt-1" type="radio" name="role" value="freelancer" />
                    <span>
                      <span class="font-semibold text-slate-900">Freelancer</span>
                      <span class="block text-sm text-slate-600">Earn with 0% commission</span>
                    </span>
                  </label>
                </div>
                <p id="roleErr" class="mt-2 text-sm text-red-600 hidden" role="alert"></p>
              </fieldset>

              <label class="mt-1 flex items-start gap-3 text-sm text-slate-600">
                <input id="terms" type="checkbox" class="mt-1" />
                <span>
                  I agree to Splinster’s
                  <a href="Terms-of-Service.html" class="text-[color:var(--spl-purple)] font-semibold hover:underline">Terms of Service</a>
                  and
                  <a href="Privacy-Policy.html" class="text-[color:var(--spl-purple)] font-semibold hover:underline">Privacy Policy</a>
                </span>
              </label>
              <p id="termsErr" class="mt-1 text-sm text-red-600 hidden" role="alert"></p>

              <button id="submitBtn" type="submit" class="mt-1 h-12 w-full rounded-xl bg-[#4B1ED6] text-white text-[15px] font-semibold shadow-sm hover:shadow-md hover:scale-[1.01] transition disabled:opacity-50 disabled:hover:scale-100 disabled:cursor-not-allowed" disabled>
                <span class="inline-flex items-center justify-center gap-2">
                  <span id="btnSpinner" class="hidden h-4 w-4 rounded-full border-2 border-white/40 border-t-white animate-spin" aria-hidden="true"></span>
                  <span id="btnText">Create Account</span>
                </span>
              </button>

              <p class="mt-3 text-sm text-slate-600">
                Already have an account?
                <a href="login.html" class="text-[color:var(--spl-purple)] font-semibold hover:underline">Sign in</a>
              </p>

              <p class="text-xs text-slate-500">
                Security note: Password hashing and CSRF validation happen server-side.
              </p>
            </form>
          </section>
        </section>
      </div>
    </div>
  </main>

  <script>
    // ========= Basic hardening (front-end only) =========
    (function enforceHttps(){
      try{
        const isLocal = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
        if(!isLocal && location.protocol === 'http:'){
          location.replace('https://' + location.host + location.pathname + location.search + location.hash);
        }
      }catch(_){/* noop */}
    })();

    // ========= State =========
    const els = {
      form: document.getElementById('signupForm'),
      wrapper: document.getElementById('authCard'),
      globalMsg: document.getElementById('globalMsg'),
      fullName: document.getElementById('fullName'),
      email: document.getElementById('email'),
      password: document.getElementById('password'),
      togglePwd: document.getElementById('togglePwd'),
      terms: document.getElementById('terms'),
      submitBtn: document.getElementById('submitBtn'),
      btnText: document.getElementById('btnText'),
      btnSpinner: document.getElementById('btnSpinner'),
      csrf: document.getElementById('csrf'),
      strengthBar: document.getElementById('strengthBar'),
      strengthLabel: document.getElementById('strengthLabel'),
      reqLen: document.getElementById('reqLen'),
      reqUpper: document.getElementById('reqUpper'),
      reqLower: document.getElementById('reqLower'),
      reqNumber: document.getElementById('reqNumber'),
      reqSpecial: document.getElementById('reqSpecial'),
      errs: {
        fullName: document.getElementById('fullNameErr'),
        email: document.getElementById('emailErr'),
        password: document.getElementById('passwordErr'),
        role: document.getElementById('roleErr'),
        terms: document.getElementById('termsErr')
      }
    };

    // UX: don't show red errors until the user interacts (or submits)
    const touched = {
      fullName: false,
      email: false,
      password: false,
      role: false,
      terms: false
    };
    let submitAttempted = false;

    // CSRF token placeholder (real validation must be server-side)
    (function initCsrf(){
      const token = (crypto?.getRandomValues ? Array.from(crypto.getRandomValues(new Uint8Array(16))).map(b => b.toString(16).padStart(2,'0')).join('') : String(Math.random()).slice(2));
      sessionStorage.setItem('spl_csrf', token);
      els.csrf.value = token;
    })();

    // Auto-focus
    setTimeout(() => els.fullName?.focus(), 60);

    // ========= Helpers =========
    const sanitize = (s) => String(s ?? '').replace(/[<>]/g, '').trim();
    const isEmail = (s) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);

    function setFieldError(key, msg, opts = {}){
      const p = els.errs[key];
      if(!p) return;

      const force = Boolean(opts.force);
      const shouldShow = force || submitAttempted || Boolean(touched[key]);

      if(msg && shouldShow){
        p.textContent = msg;
        p.classList.remove('hidden');
      }else{
        p.textContent = '';
        p.classList.add('hidden');
      }
    }

    function setGlobal(type, msg){
      if(!msg){
        els.globalMsg.classList.add('hidden');
        els.globalMsg.textContent = '';
        els.globalMsg.className = 'mt-5 hidden';
        return;
      }
      const base = 'mt-5 rounded-2xl border p-4 text-sm';
      const style = type === 'error'
        ? ' border-red-200 bg-red-50 text-red-700'
        : ' border-emerald-200 bg-emerald-50 text-emerald-800';
      els.globalMsg.className = base + style;
      els.globalMsg.textContent = msg;
      els.globalMsg.classList.remove('hidden');
    }

    function roleValue(){
      const r = els.form.querySelector('input[name="role"]:checked');
      return r ? r.value : '';
    }

    function passwordScore(pw){
      const s = String(pw || '');
      const checks = {
        len: s.length >= 8,
        upper: /[A-Z]/.test(s),
        lower: /[a-z]/.test(s),
        number: /\d/.test(s),
        special: /[^A-Za-z0-9]/.test(s)
      };
      const score = Object.values(checks).filter(Boolean).length; // 0..5
      return { score, checks };
    }

    function updatePwdUI(){
      const { score, checks } = passwordScore(els.password.value);

      const setReq = (el, ok) => {
        el.textContent = ok ? '✓' : '•';
        el.className = ok ? 'text-emerald-600' : 'text-slate-400';
      };
      setReq(els.reqLen, checks.len);
      setReq(els.reqUpper, checks.upper);
      setReq(els.reqLower, checks.lower);
      setReq(els.reqNumber, checks.number);
      setReq(els.reqSpecial, checks.special);

      const pct = Math.min(100, Math.round((score / 5) * 100));
      els.strengthBar.style.width = pct + '%';

      let label = 'Weak';
      let color = 'bg-red-500';
      if(score >= 4){ label = 'Strong'; color = 'bg-emerald-500'; }
      else if(score >= 3){ label = 'Medium'; color = 'bg-amber-500'; }

      els.strengthLabel.textContent = label;
      els.strengthBar.className = `h-full transition-all ${color}`;
    }

    function validate(){
      const name = sanitize(els.fullName.value);
      const email = sanitize(els.email.value);
      const pw = els.password.value;
      const role = roleValue();

      let ok = true;

      if(name.length < 2){ ok = false; setFieldError('fullName', 'Please enter your full name.'); }
      else setFieldError('fullName', '');

      if(!isEmail(email)){ ok = false; setFieldError('email', 'Please enter a valid email address.'); }
      else setFieldError('email', '');

      const { checks } = passwordScore(pw);
      const pwOk = checks.len && checks.upper && checks.lower && checks.number && checks.special;
      if(!pwOk){ ok = false; setFieldError('password', 'Password must meet all requirements above.'); }
      else setFieldError('password', '');

      if(!role){ ok = false; setFieldError('role', 'Please select Client or Freelancer.'); }
      else setFieldError('role', '');

      if(!els.terms.checked){ ok = false; setFieldError('terms', 'You must agree to the Terms and Privacy Policy.'); }
      else setFieldError('terms', '');

      // Keep the button disabled until valid, but don't show errors until touched/submitted
      els.submitBtn.disabled = !ok;
      return ok;
    }

    // ========= UI events =========
    els.togglePwd.addEventListener('click', () => {
      const isHidden = els.password.type === 'password';
      els.password.type = isHidden ? 'text' : 'password';
      els.togglePwd.textContent = isHidden ? 'Hide' : 'Show';
      els.togglePwd.setAttribute('aria-label', isHidden ? 'Hide password' : 'Show password');
      els.password.focus();
    });

    ['input','blur'].forEach(evt => {
      els.fullName.addEventListener(evt, () => {
        if(evt === 'blur') touched.fullName = true;
        setGlobal('', '');
        validate();
      });
      els.email.addEventListener(evt, () => {
        if(evt === 'blur') touched.email = true;
        setGlobal('', '');
        validate();
      });
      els.password.addEventListener(evt, () => {
        if(evt === 'blur') touched.password = true;
        setGlobal('', '');
        updatePwdUI();
        validate();
      });
    });

    els.form.querySelectorAll('input[name="role"]').forEach(r => r.addEventListener('change', () => {
      touched.role = true;
      setGlobal('', '');
      validate();
    }));

    els.terms.addEventListener('change', () => {
      touched.terms = true;
      setGlobal('', '');
      validate();
    });

    updatePwdUI();
    validate();

    // ========= OAuth buttons (placeholders) =========
    document.querySelectorAll('.oauth-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const provider = btn.getAttribute('data-oauth');
        window.location.href = `/auth/${provider}`;
      });
    });

    // ========= Submit =========
    function setLoading(loading, label){
      els.submitBtn.disabled = loading;
      els.btnSpinner.classList.toggle('hidden', !loading);
      els.btnText.textContent = loading ? (label || 'Creating account...') : 'Create Account';
    }

    function shake(){
      els.wrapper?.classList.remove('shake');
      void els.wrapper?.offsetWidth;
      els.wrapper?.classList.add('shake');
    }

    els.form.addEventListener('submit', async (e) => {
      e.preventDefault();
      setGlobal('', '');
      submitAttempted = true;

      if(!validate()){
        shake();
        return;
      }

      const payload = {
        fullName: sanitize(els.fullName.value),
        email: sanitize(els.email.value).toLowerCase(),
        password: els.password.value,
        role: roleValue()
      };

      setLoading(true);

      try{
        // Demo error case
        if(payload.email.includes('exists')){
          setGlobal('error', 'Email already registered. Sign in?');
          setFieldError('email', 'Email already registered.');
          setLoading(false);
          return;
        }

        const csrf = sessionStorage.getItem('spl_csrf') || '';
        const res = await fetch('/api/auth/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'X-CSRF-Token': csrf },
          body: JSON.stringify(payload)
        }).catch(() => null);

        // If no backend, simulate success
        if(!res){
          await new Promise(r => setTimeout(r, 900));
          setGlobal('success', 'Account created. Redirecting...');
          setTimeout(() => { window.location.href = '/dashboard'; }, 650);
          return;
        }

        const data = await res.json().catch(() => ({}));
        if(!res.ok || data?.success === false){
          const msg = data?.error || 'Unable to create account. Please try again.';
          setGlobal('error', msg);
          shake();
          setLoading(false);
          return;
        }

        setGlobal('success', 'Account created. Redirecting...');
        const redirectTo = data?.redirectTo || '/dashboard';
        setTimeout(() => { window.location.href = redirectTo; }, 650);

      }catch(err){
        setGlobal('error', 'Connection failed. Check internet.');
        shake();
        setLoading(false);
      }
    });
  </script>
</body>
</html>
